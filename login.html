<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Unique Importados</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        .auth-container {
            min-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 20px;
        }
        
        .auth-box {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 3rem;
            box-shadow: var(--shadow-xl);
            max-width: 450px;
            width: 100%;
        }
        
        .auth-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        .auth-tab {
            flex: 1;
            padding: 1rem;
            background: transparent;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .auth-tab.active {
            color: var(--primary-color);
        }
        
        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-color);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-error {
            background: #fee;
            color: #c33;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            display: none;
        }
        
        .form-error.show {
            display: block;
        }
        
        .form-success {
            background: #efe;
            color: #3c3;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            display: none;
        }
        
        .form-success.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="/" style="text-decoration: none; color: inherit;"><h2>🍎 Unique Importados</h2></a>
            </div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="/">Início</a></li>
                <li><a href="/catalogo.html?categoria=iphone">iPhone</a></li>
                <li><a href="/catalogo.html?categoria=mac">Mac</a></li>
                <li><a href="/catalogo.html?categoria=ipad">iPad</a></li>
                <li><a href="/catalogo.html?categoria=applewatch">Apple Watch</a></li>
                <li><a href="/catalogo.html?categoria=audio">Áudio</a></li>
                <li><a href="/catalogo.html?categoria=acessorios">Acessórios</a></li>
                <li><a href="/catalogo.html?categoria=ofertas">Ofertas</a></li>
            </ul>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <a href="/carrinho.html" style="position: relative; text-decoration: none; color: white; font-size: 1.5rem; padding: 0.5rem; display: flex; align-items: center;">
                    🛒
                    <span id="carrinho-contador" style="display: none; position: absolute; top: -5px; right: -5px; background: #ff3b30; color: white; border-radius: 50%; width: 22px; height: 22px; font-size: 0.75rem; font-weight: 700; align-items: center; justify-content: center;">0</span>
                </a>
                <a href="/login.html" id="login-link" style="text-decoration: none; color: white; padding: 0.5rem 1rem;">Entrar</a>
                <div id="user-menu" style="display: none; align-items: center; gap: 1rem;">
                    <span class="user-name" style="color: white;">Usuário</span>
                    <a href="/area-cliente.html" style="text-decoration: none; color: white; padding: 0.5rem 1rem;">Área do Cliente</a>
                    <button onclick="auth.logout()" style="background: transparent; border: 1px solid white; color: white; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">Sair</button>
                </div>
            </div>
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <section class="auth-container">
        <div class="auth-box">
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="trocarAba('login')">Entrar</button>
                <button class="auth-tab" onclick="trocarAba('cadastro')">Cadastrar</button>
            </div>

            <!-- Formulário de Login -->
            <form id="loginForm" class="auth-form active" onsubmit="fazerLogin(event)">
                <div class="form-error" id="loginError"></div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" name="senha" required>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">Entrar</button>
                <p style="text-align: center; margin-top: 1rem; color: var(--text-light);">
                    Não tem conta? <a href="#" onclick="trocarAba('cadastro'); return false;" style="color: var(--primary-color);">Cadastre-se</a>
                </p>
            </form>

            <!-- Formulário de Cadastro -->
            <form id="cadastroForm" class="auth-form" onsubmit="fazerCadastro(event)">
                <div class="form-error" id="cadastroError"></div>
                <div class="form-success" id="cadastroSuccess"></div>
                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" name="nome" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" name="senha" required minlength="6">
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="tel" name="telefone" required>
                </div>
                <div class="form-group">
                    <label>CEP</label>
                    <input type="text" name="cep" id="cep" maxlength="9" onblur="buscarCEP()">
                </div>
                <div class="form-group">
                    <label>Cidade</label>
                    <input type="text" name="cidade" id="cidade">
                </div>
                <div class="form-group">
                    <label>Estado</label>
                    <input type="text" name="estado" id="estado" maxlength="2">
                </div>
                <div class="form-group">
                    <label>Endereço Completo</label>
                    <textarea name="endereco" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">Cadastrar</button>
                <p style="text-align: center; margin-top: 1rem; color: var(--text-light);">
                    Já tem conta? <a href="#" onclick="trocarAba('login'); return false;" style="color: var(--primary-color);">Entrar</a>
                </p>
            </form>
        </div>
    </section>

    <script src="auth.js"></script>
    <script src="carrinho.js"></script>
    <script src="script.js"></script>
    <script>
        function trocarAba(aba) {
            document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            
            if (aba === 'login') {
                document.querySelector('.auth-tab:first-child').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelector('.auth-tab:last-child').classList.add('active');
                document.getElementById('cadastroForm').classList.add('active');
            }
        }

        async function fazerLogin(e) {
            e.preventDefault();
            const errorDiv = document.getElementById('loginError');
            errorDiv.classList.remove('show');
            
            const formData = new FormData(e.target);
            const email = formData.get('email');
            const senha = formData.get('senha');
            
            const resultado = await auth.login(email, senha);
            
            if (resultado.sucesso) {
                window.location.href = '/area-cliente.html';
            } else {
                errorDiv.textContent = resultado.erro;
                errorDiv.classList.add('show');
            }
        }

        async function fazerCadastro(e) {
            e.preventDefault();
            const errorDiv = document.getElementById('cadastroError');
            const successDiv = document.getElementById('cadastroSuccess');
            errorDiv.classList.remove('show');
            successDiv.classList.remove('show');
            
            const formData = new FormData(e.target);
            const nome = formData.get('nome');
            const email = formData.get('email');
            const senha = formData.get('senha');
            const telefone = formData.get('telefone');
            const endereco = formData.get('endereco');
            const cep = formData.get('cep');
            const cidade = formData.get('cidade');
            const estado = formData.get('estado');
            
            const resultado = await auth.cadastrar(nome, email, senha, telefone, endereco, cep, cidade, estado);
            
            if (resultado.sucesso) {
                successDiv.textContent = 'Cadastro realizado com sucesso! Redirecionando...';
                successDiv.classList.add('show');
                setTimeout(() => {
                    window.location.href = '/area-cliente.html';
                }, 2000);
            } else {
                errorDiv.textContent = resultado.erro;
                errorDiv.classList.add('show');
            }
        }

        // Máscara de CEP
        document.getElementById('cep').addEventListener('input', function(e) {
            let valor = e.target.value.replace(/\D/g, '');
            if (valor.length > 5) {
                valor = valor.substring(0, 5) + '-' + valor.substring(5, 8);
            }
            e.target.value = valor;
        });

        // Buscar CEP
        async function buscarCEP() {
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            if (cep.length === 8) {
                try {
                    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                    const data = await response.json();
                    if (!data.erro) {
                        document.getElementById('cidade').value = data.localidade;
                        document.getElementById('estado').value = data.uf;
                        if (document.querySelector('[name="endereco"]').value === '') {
                            document.querySelector('[name="endereco"]').value = `${data.logradouro}, ${data.bairro}`;
                        }
                    }
                } catch (e) {
                    console.error('Erro ao buscar CEP:', e);
                }
            }
        }
    </script>
</body>
</html>

